:

Response Message: Ø§Ù„Ù„ÙŠ Ø¨ØªØ¨Ø¹ØªÙ‡Ø§ Ù„Ø¹Ù…Ù„Ø§Ø¦Ùƒ Ø£Ùˆ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø¹Ø¯ ÙƒÙ„ Ø¹Ù…Ù„ÙŠØ©.

Database Notifications: Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù†ÙˆØªÙŠÙÙŠÙƒÙŠØ´Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù€ DB.

SignalR: Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ (Real-Time).

Ø£Ù†Øª ÙƒØ¯Ù‡ Ø¨ØªØ¬Ù…Ø¹ ÙƒÙ„ Ø§Ù„Ø­Ø§Ø¬Ø§Øª Ø¯ÙŠ Ù…Ø¹ Ø¨Ø¹Ø¶ Ø¹Ø´Ø§Ù† ØªÙˆÙØ± ØªØ¬Ø±Ø¨Ø© ÙƒØ§Ù…Ù„Ø© Ù…Ù† Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†ÙˆØªÙŠÙÙŠÙƒÙŠØ´Ù† Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¨Ø´ÙƒÙ„ Ø³Ø±ÙŠØ¹ ÙˆÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠØŒ Ù…Ø¹ ØªØ®Ø²ÙŠÙ† ÙƒÙ„ Ø­Ø§Ø¬Ø© ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.

Ù‡Ù†Ù…Ø´ÙŠ Ù…Ø¹ Ø¨Ø¹Ø¶ Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ© ÙˆÙ†Ù†Ø¸Ù… ÙƒÙ„ Ø´ÙŠØ¡ Ø¨Ø­ÙŠØ« ÙŠØ¨Ù‚Ù‰ ÙˆØ§Ø¶Ø­ ÙˆÙˆØ§Ø¶Ø­ ÙÙŠ Ø§Ù„Ù€ Backend.

Ø§Ù„Ù€ Flow Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:
Ø§Ù„Ù€ Controller ÙŠØ³ØªÙ‚Ø¨Ù„ Ø·Ù„Ø¨ (Ù…Ø«Ù„Ø§Ù‹: Ù…Ø±ÙŠØ¶ Ø­Ø¬Ø² Ù…Ø¹Ø§Ø¯ØŒ Ø¯ÙƒØªÙˆØ± Ù†Ø²Ù„ Ù…Ø¹Ø§Ø¯ Ø¬Ø¯ÙŠØ¯).

Ø§Ù„Ù€ Service ÙŠØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø·Ù„Ø¨ØŒ ÙŠØ±Ø³Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¥Ù„Ù‰ Ø§Ù„Ù€ Database.

Ø§Ù„Ù€ Notification ÙŠØªÙ… Ø­ÙØ¸Ù‡Ø§ ÙÙŠ Ø§Ù„Ù€ DatabaseØŒ Ø«Ù… ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„Ù‡Ø§ Ø¹Ø¨Ø± SignalR Ø¥Ù„Ù‰ Ø§Ù„Ù€ User.

ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©ØŒ ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Response Message Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„Ù€ API.

ğŸ§‘â€ğŸ’» 1. Model for Notifications (ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù†ÙˆØªÙŠÙÙŠÙƒÙŠØ´Ù† ÙÙŠ Ø§Ù„Ù€ DB)
csharp
Copy
Edit
public class Notification
{
    public int Id { get; set; }
    public string UserId { get; set; }
    public string Title { get; set; }
    public string Message { get; set; }
    public bool IsRead { get; set; } = false;
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
}
ğŸ§‘â€ğŸ’» 2. Service Layer: NotificationService
ÙÙŠ NotificationServiceØŒ Ù‡Ù†ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù€ Database Ùˆ SignalR ÙˆÙ†Ø±Ø³Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù…Ø¹ Ø§Ù„Ø±Ø¯ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù….

NotificationService.cs
csharp
Copy
Edit
public class NotificationService : INotificationService
{
    private readonly AppDbContext _context;
    private readonly IHubContext<NotificationHub> _hubContext;

    public NotificationService(AppDbContext context, IHubContext<NotificationHub> hubContext)
    {
        _context = context;
        _hubContext = hubContext;
    }

    public async Task SendNotificationAsync(string userId, string title, string message)
    {
        // 1. ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù†ÙˆØªÙŠÙÙŠÙƒÙŠØ´Ù† ÙÙŠ DB
        var notification = new Notification
        {
            UserId = userId,
            Title = title,
            Message = message
        };
        
        _context.Notifications.Add(notification);
        await _context.SaveChangesAsync();

        // 2. Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†ÙˆØªÙŠÙÙŠÙƒÙŠØ´Ù† Ø¹Ø¨Ø± SignalR Ù„Ù„Ù€ User
        await _hubContext.Clients.Group($"User_{userId}").SendAsync("ReceiveNotification", new
        {
            Title = title,
            Message = message,
            CreatedAt = notification.CreatedAt
        });

        // 3. Ø¥Ø±Ø³Ø§Ù„ Response Ù„Ù„Ù€ API
        return new ResponseMessage
        {
            Success = true,
            Message = "Notification sent successfully."
        };
    }

    // Notify the doctor when a patient books an appointment
    public async Task NotifyDoctorOfBooking(string doctorId, string patientName)
    {
        var title = "ğŸ“… Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯";
        var message = $"Ø§Ù„Ù…Ø±ÙŠØ¶ {patientName} Ø­Ø¬Ø² Ù…Ø¹Ø§Ø¯ Ø¬Ø¯ÙŠØ¯.";

        var response = await SendNotificationAsync(doctorId, title, message);
        return response;
    }

    // Notify patients when a doctor adds a new time slot
    public async Task NotifyPatientsOfDoctorUpdate(string doctorId)
    {
        var patientIds = await _context.Appointments
            .Where(a => a.DoctorId == doctorId)
            .Select(a => a.PatientId)
            .Distinct()
            .ToListAsync();

        var adminIds = await _userManager.GetUsersInRoleAsync("Admin");
        var adminUserIds = adminIds.Select(a => a.Id).ToList();

        var title = "Ù…Ø¹Ø§Ø¯ Ø¬Ø¯ÙŠØ¯ Ù…ØªØ§Ø­";
        var message = "Ø¯ÙƒØªÙˆØ±Ùƒ Ù†Ø²Ù„ Ù…Ø¹Ø§Ø¯ Ø¬Ø¯ÙŠØ¯ Ø§Ø­Ø¬Ø² Ø¨Ø³Ø±Ø¹Ø©!";

        foreach (var patientId in patientIds)
        {
            await SendNotificationAsync(patientId, title, message);
        }

        foreach (var adminId in adminUserIds)
        {
            await SendNotificationAsync(adminId, $"Ù…Ø¹Ø§Ø¯ Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø¯ÙƒØªÙˆØ± {doctorId}", message);
        }
    }
}
ResponseMessage: Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙŠ Ø³ØªØ±Ø¬Ø¹ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙƒÙ€ Response Ù…Ù† Ø§Ù„Ù€ API.
ResponseMessage.cs
csharp
Copy
Edit
public class ResponseMessage
{
    public bool Success { get; set; }
    public string Message { get; set; }
}
ğŸ§‘â€ğŸ’» 3. Controller Layer: NotificationController
Ù‡Ù†Ø§ Ø§Ù„Ù€ Controller Ù‡ÙŠØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù…Ù† Ø§Ù„Ù€ API ÙˆÙŠØ±Ø¯ Ø¹Ù„ÙŠÙ‡Ø§ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ResponseMessage.

NotificationController.cs
csharp
Copy
Edit
[ApiController]
[Route("api/[controller]")]
public class NotificationController : ControllerBase
{
    private readonly INotificationService _notificationService;
    private readonly UserManager<ApplicationUser> _userManager;

    public NotificationController(INotificationService notificationService, UserManager<ApplicationUser> userManager)
    {
        _notificationService = notificationService;
        _userManager = userManager;
    }

    // 1. Ù…Ø±ÙŠØ¶ Ø­Ø¬Ø² Ù…Ø¹Ø§Ø¯
    [HttpPost("patient-booked/{doctorId}/{patientName}")]
    public async Task<IActionResult> PatientBooked(string doctorId, string patientName)
    {
        var response = await _notificationService.NotifyDoctorOfBooking(doctorId, patientName);

        return Ok(response); // Ù†Ø±Ø¬Ø¹ Response Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø¹Ø¯ Ù…Ø§ ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†ÙˆØªÙŠÙÙŠÙƒÙŠØ´Ù†
    }

    // 2. Ø¯ÙƒØªÙˆØ± Ù†Ø²Ù„ Ù…Ø¹Ø§Ø¯ Ø¬Ø¯ÙŠØ¯
    [HttpPost("doctor-time-updated/{doctorId}")]
    public async Task<IActionResult> DoctorTimeUpdated(string doctorId)
    {
        var response = await _notificationService.NotifyPatientsOfDoctorUpdate(doctorId);

        return Ok(response); // Ù†Ø±Ø¬Ø¹ Response Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø¹Ø¯ Ù…Ø§ ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†ÙˆØªÙŠÙÙŠÙƒÙŠØ´Ù†
    }
}
ğŸ§‘â€ğŸ’» 4. SignalR Hub
Ù‡Ù†Ø§ Ø¨Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù€ SignalR Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ (Real-Time) Ø¥Ù„Ù‰ Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†.

NotificationHub.cs
csharp
Copy
Edit
using Microsoft.AspNetCore.SignalR;

public class NotificationHub : Hub
{
    // Optional: Methods for joining groups
    public async Task JoinGroup(string groupName)
    {
        await Groups.AddToGroupAsync(Context.ConnectionId, groupName);
    }

    public async Task LeaveGroup(string groupName)
    {
        await Groups.RemoveFromGroupAsync(Context.ConnectionId, groupName);
    }
}
ğŸ§‘â€ğŸ’» 5. Program.cs or Startup.cs Configuration
ÙÙŠ Program.cs Ø£Ùˆ Startup.csØŒ ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù€ SignalR Ùˆ Ø§Ù„Ù€ NotificationService.

csharp
Copy
Edit
public class Startup
{
    public void ConfigureServices(IServiceCollection services)
    {
        services.AddSignalR();
        services.AddScoped<INotificationService, NotificationService>();
    }

    public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
    {
        app.UseEndpoints(endpoints =>
        {
            endpoints.MapHub<NotificationHub>("/notificationHub");
        });
    }
}
ğŸ§‘â€ğŸ’» 6. Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
Ø§Ù„Ù€ Controller Ø¨ÙŠØ³ØªÙ‚Ø¨Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù…Ù† Ø§Ù„Ù€ API (Ù…Ø«Ù„Ù‹Ø§: Ù…Ø±ÙŠØ¶ Ø­Ø¬Ø² Ø£Ùˆ Ø¯ÙƒØªÙˆØ± Ù†Ø²Ù„ Ù…Ø¹Ø§Ø¯).

Ø§Ù„Ù€ Service:

ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†ÙˆØªÙŠÙÙŠÙƒÙŠØ´Ù† Ø¥Ù„Ù‰ Ø§Ù„Ù€ DB.

ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†ÙˆØªÙŠÙÙŠÙƒÙŠØ´Ù† Ø¹Ø¨Ø± SignalR Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†.

ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Response Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø¨Ø± Ø§Ù„Ù€ API.

SignalR: ÙŠÙ‚ÙˆÙ… Ø¨Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ.

âœ… Ø®Ù„Ø§ØµØ©:
Ø§Ù„Ù€ Backend Ø¨ÙŠÙ†ÙØ° ÙƒÙ„ Ø´ÙŠØ¡: ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù†ÙˆØªÙŠÙÙŠÙƒÙŠØ´Ù† ÙÙŠ Ø§Ù„Ù€ DBØŒ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†ÙˆØªÙŠÙÙŠÙƒÙŠØ´Ù† Ø¹Ø¨Ø± SignalRØŒ Ø¥Ø±Ø¬Ø§Ø¹ Response Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù….

Ø§Ù„Ù€ SignalR Hub Ø¨ÙŠÙ†Ù‚Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„Ù„Ù€ Users Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ.

Ø§Ù„Ù€ Controller Ø¨ÙŠØ¨Ø¹Øª Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙÙŠ Ø§Ù„Ù€ API Response Messages Ù„Ù†Ø¬Ø§Ø­ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©.

Ù‡Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø¯Ù‡ Ù…Ø¸Ø¨ÙˆØ· Ù„ÙŠÙƒØŸ Ù„Ùˆ ÙÙŠÙ‡ Ø­Ø§Ø¬Ø© Ø¹Ø§ÙŠØ² ØªØ¶ÙŠÙÙ‡Ø§ Ø£Ùˆ ØªØ¹Ø¯Ù„ Ø¹Ù„ÙŠÙ‡Ø§ Ù‚ÙˆÙ„ÙŠ!








